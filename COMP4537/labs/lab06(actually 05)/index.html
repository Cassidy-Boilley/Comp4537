<!-- Server1 - index.html -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client</title>
</head>

<body>
    <h1>Client</h1>

    <button type="button" onclick="insertAll()">Insert All Patients</button>

    <div id="insertResponse"></div>

    <form id="queryForm">
        <textarea id="sqlQuery" placeholder="Enter SQL query"></textarea><br>
        <input type="submit" value="Submit">
    </form>

    <div id="queryResponse"></div>

    <script>
        function insertAll() {
            const patients = [
                { name: 'Sara Brown', dob: '1901-01-01' },
                { name: 'John Smith', dob: '1941-01-01' },
                { name: 'Jack Ma', dob: '1961-01-30' },
                { name: 'Elon Musk', dob: '1999-01-01' }
            ];

            const promises = patients.map(patient => insertPatient(patient));

            Promise.all(promises)
                .then(responses => {
                    document.getElementById('insertResponse').textContent = 'All patients inserted successfully';
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('insertResponse').textContent = 'Error: ' + error.message;
                });
        }

        function insertPatient(patient) {
            return fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `queryType=INSERT&name=${encodeURIComponent(patient.name)}&dob=${encodeURIComponent(patient.dob)}`,
            });
            console.log(`${patient.name} inserted successfully`);
        }

        document.getElementById('queryForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const sqlQuery = document.getElementById('sqlQuery').value.trim();
            const queryType = sqlQuery.toUpperCase().startsWith('SELECT') ? 'SELECT' : 'INSERT';

            const requestOptions = {
                method: queryType === 'SELECT' ? 'GET' : 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
            };

            if (queryType === 'SELECT') {
                // Remove body for GET requests
                fetch('http://localhost:3000?queryType=SELECT', requestOptions)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('queryResponse').textContent = JSON.stringify(data);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            } else {
                // Add body for POST requests
                requestOptions.body = `queryType=${queryType}&sqlQuery=${sqlQuery}`;

                fetch('http://localhost:3000', requestOptions)
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('queryResponse').textContent = data;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }
        });
    </script>
</body>

</html>
